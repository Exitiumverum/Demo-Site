// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id // Matches Supabase auth.users.id (UUID)
  email     String   @unique
  password  String   // Not used anymore - Supabase Auth handles passwords. Kept for backward compatibility.
  stores    Store[]
  createdAt DateTime @default(now())
}

model Store {
  id          String        @id @default(cuid())
  owner       User          @relation(fields: [ownerId], references: [id])
  ownerId     String
  name        String
  slug        String        @unique
  logoUrl     String?
  phone       String?
  address     String?
  createdAt   DateTime      @default(now())
  products    Product[]
  orders      Order[]
  settings    StoreSettings?
}

model StoreSettings {
  id                 String  @id @default(cuid())
  store              Store   @relation(fields: [storeId], references: [id], onDelete: Cascade)
  storeId            String  @unique
  paymentProvider    String? // e.g. "tranzila", "cardcom"
  paymentPublicKey   String?
  paymentSecretKey   String?
  paymentRedirectUrl String?
}

model Product {
  id             String   @id @default(cuid())
  store          Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)
  storeId        String
  title          String
  description    String
  price          Int      // store in minor units (e.g. agorot)
  imageUrl       String?
  category       String?
  stock          Int      @default(0)
  seoTitle       String?
  seoDescription String?
  createdAt      DateTime @default(now())
}

model Order {
  id           String   @id @default(cuid())
  store        Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)
  storeId      String
  customerName String
  customerEmail String?
  customerPhone String?
  items        Json     // array of { productId, quantity, priceAtPurchase }
  totalPrice   Int
  status       String   // "new" | "processing" | "shipped"
  createdAt    DateTime @default(now())
}

